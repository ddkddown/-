##Posix 多线程编程
###Posix
因为有多种unix操作系统，而这些unix操作系统上实现的系统调用名称可能会有不同，因此要编写在这些unix操作系统上可移植的程序就会比较困难。

所以POSIX标准定义了操作系统应该为应用程序提供的接口标准，是IEEE为要在各种UNIX操作系统上运行的软件而定义的一系列API标准的总称。

######简而言之: POSIX就是unix操作系统上的统一系统接口标准。

###什么是线程
####进程
进程是操作系统创建的，有着相对线程较大的内存开销,包含一些进程资源和进程执行状态的信息:
1. 进程ID, 进程组ID, 用户ID, 用户组ID
2. 环境变量
3. 工作目录
4. 程序指令
5. 寄存器
6. 栈
7. 堆
8. 文件描述符
9. 信号操作
10. 动态库
11. 进程通信IPC

####线程
线程依赖上述的进程资源，并会从其中拷贝最基础的资源以让自身作为独立运行的程序实体。线程需要包含一下信息以成为独立的控制流:
1. 栈指针
2. 寄存器
3. 调度属性(调度策略，调度优先级)
4. 挂起和屏蔽的信号组
5. 线程特定数据

简而言之, 在unix环境下，线程具有以下特性:
1. 依赖并使用进程资源。
2. 只要操作系统支持，并且依赖进程不退出，线程将拥有自己的独立控制流。
3. 为了独立运行会从进程中拷贝最基础的资源。
4. 会和同进程的其他线程一起共享进程资源
5. 进程退出，线程退出
6. 线程之所以比进程更轻量，原因在于线程不再需要包含进程的大部分资源，直接使用进程的资源即可。

但是因为同进程的线程共享进程资源，那么即会导致一些问题:
1. 线程对共享资源的修改会被其他线程访问。
2. 多个指针指向相同数据
3. 可以对共享内存区域进行读写，因此需要显式的同步消息。

###什么是Pthreads
1. 因为一些历史原因，硬件提供商各自分别实现了自身的线程版本，这些实现各有不同，对软件层面来说，创建多线程的可移植应用就会比较困难。
2. 为了充分利用线程的功能，就需要一个标准的编程接口协议。
3. POSIX就诞生了！pthread就是POSIX里的线程编程模块。
4. pthread是由c语言和一组系统调用组成，包含pthread.h头文件和一个线程库。


###为什么要用Pthreads
####轻量
1. 创建线程的开销要比创建进程的开销小很多，同时，管理线程的开销也要比管理进程开销小很多。
####高效的数据交换/通信
例如：进程间使用共享内存通信，则至少会存在一次内存拷贝的操作。但是对于线程而言，因为线程间都使用同一个进程的虚拟地址空间，就没有中间内存的拷贝，不用像进程那样有数据传输，线程间只需要简单地传递一个指针，用指针指向需要传递的数据即可。

在最差的情况下，线程间通信变成cache-CPU或者memory-CPU，即使如此，通信速度也快过进程间共享内存的通信。

###设计多线程程序
具有如下特征的程序适合使用多线程
1. 数据可以在多个控制流中使用，或者一项任务可以在多个控制流中执行
2. 可能存在长IO阻塞
3. 在某些时候存在CPU密集型操作。
######（对于这一点有个问题：对于 CPU 密集型计算，多线程本质上是提升多核 CPU 的利用率，所以对于一个 8 核的 CPU，每个核一个线程，理论上创建 8 个线程就可以了。设置了过多的线程，每个线程都想去利用 CPU 资源来执行自己的任务，这就会造成不必要的上下文切换，此时线程数的增多并没有让性能提升，反而由于线程数量过多会导致性能下降。）
